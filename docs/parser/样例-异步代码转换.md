# 异步代码转换样例

## 概述

本文档展示如何将异步代码转换为自然语言表示。

## 转换模板

```
Async function {normalizedName} {docstringPart} defined as {normalizedSignature} {context}
```

## 样例1：async/await 函数

### 输入代码

```typescript
/**
 * Fetch user data from the API
 */
async function fetchUserData(userId: string): Promise<User> {
    const response = await fetch(`/api/users/${userId}`);
    const data = await response.json();
    return data;
}
```

### 转换结果

```
Async function Fetch user data that does Fetch user data from the API defined as async function fetch user data user id promise user
```

---

## 样例2：Promise 链式调用

### 输入代码

```typescript
/**
 * Process data with multiple transformations
 */
function processData(input: string): Promise<Result> {
    return fetch(input)
        .then(response => response.json())
        .then(data => transform(data))
        .then(result => validate(result));
}
```

### 转换结果

```
Async function Process data that does Process data with multiple transformations defined as function process data input promise result
```

---

## 样例3：并发执行

### 输入代码

```typescript
/**
 * Fetch multiple users concurrently
 */
async function fetchMultipleUsers(userIds: string[]): Promise<User[]> {
    const promises = userIds.map(id => fetchUserData(id));
    return Promise.all(promises);
}
```

### 转换结果

```
Async function Fetch multiple users that does Fetch multiple users concurrently defined as async function fetch multiple users user ids array promise user array
```

---

## 样例4：异步迭代

### 输入代码

```typescript
/**
 * Process items asynchronously
 */
async function processItems(items: Item[]): Promise<void> {
    for (const item of items) {
        await processItem(item);
    }
}
```

### 转换结果

```
Async function Process items that does Process items asynchronously defined as async function process items items array promise void
```

---

## 样例5：带错误处理的异步函数

### 输入代码

```typescript
/**
 * Safely fetch data with error handling
 */
async function safeFetch(url: string): Promise<Data | null> {
    try {
        const response = await fetch(url);
        return await response.json();
    } catch (error) {
        console.error('Fetch failed:', error);
        return null;
    }
}
```

### 转换结果

```
Async function Safe fetch that does Safely fetch data with error handling defined as async function safe fetch url promise data or null
```

---

## 样例6：超时控制

### 输入代码

```typescript
/**
 * Fetch with timeout
 */
async function fetchWithTimeout(url: string, timeout: number): Promise<Response> {
    const controller = new AbortController();
    const timeoutId = setTimeout(() => controller.abort(), timeout);
    
    try {
        const response = await fetch(url, { signal: controller.signal });
        clearTimeout(timeoutId);
        return response;
    } catch (error) {
        clearTimeout(timeoutId);
        throw error;
    }
}
```

### 转换结果

```
Async function Fetch with timeout that does Fetch with timeout defined as async function fetch with timeout url timeout promise response
```

---

## 样例7：重试机制

### 输入代码

```typescript
/**
 * Fetch with retry logic
 */
async function fetchWithRetry(url: string, maxRetries: number = 3): Promise<Response> {
    for (let i = 0; i < maxRetries; i++) {
        try {
            const response = await fetch(url);
            if (response.ok) return response;
        } catch (error) {
            if (i === maxRetries - 1) throw error;
            await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)));
        }
    }
    throw new Error('Max retries exceeded');
}
```

### 转换结果

```
Async function Fetch with retry that does Fetch with retry logic defined as async function fetch with retry url max retries promise response
```

---

## 样例8：异步生成器

### 输入代码

```typescript
/**
 * Generate items asynchronously
 */
async function* generateItems(): AsyncGenerator<Item> {
    for (let i = 0; i < 10; i++) {
        await new Promise(resolve => setTimeout(resolve, 100));
        yield { id: i, value: `Item ${i}` };
    }
}
```

### 转换结果

```
Async function Generate items that does Generate items asynchronously defined as async function generate items async generator item
```

---

## 样例9：并行限制

### 输入代码

```typescript
/**
 * Process items with concurrency limit
 */
async function processWithLimit(items: Item[], limit: number): Promise<Result[]> {
    const results: Result[] = [];
    const executing: Promise<void>[] = [];
    
    for (const item of items) {
        const promise = processItem(item).then(result => {
            results.push(result);
        });
        executing.push(promise);
        
        if (executing.length >= limit) {
            await Promise.race(executing);
            executing.splice(executing.indexOf(promise), 1);
        }
    }
    
    await Promise.all(executing);
    return results;
}
```

### 转换结果

```
Async function Process with limit that does Process items with concurrency limit defined as async function process with limit items array limit promise result array
```

---

## 样例10：回调转Promise

### 输入代码

```typescript
/**
 * Convert callback-based function to Promise
 */
function readFileAsPromise(path: string): Promise<string> {
    return new Promise((resolve, reject) => {
        fs.readFile(path, 'utf8', (err, data) => {
            if (err) reject(err);
            else resolve(data);
        });
    });
}
```

### 转换结果

```
Async function Read file as promise that does Convert callback based function to Promise defined as function read file as promise path promise string
```

---

## 转换要点

1. **异步标识**：在函数类型前添加 "async" 标识
2. **Promise 类型**：保留 Promise 返回类型信息
3. **并发操作**：描述并发执行的特点
4. **错误处理**：在描述中提及错误处理逻辑
5. **超时/重试**：描述超时控制和重试机制

## 处理策略

- **async/await**：标记为异步函数
- **Promise 链**：简化为异步函数描述
- **并发执行**：标注并发特性
- **错误处理**：在描述中体现
- **复杂逻辑**：简化描述核心功能