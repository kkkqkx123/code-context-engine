# 函数转换样例

## 概述

本文档展示如何将不同编程语言的函数转换为自然语言表示，以提高通用NLP嵌入模型的语义理解能力。

## 转换模板

```
Function {normalizedName} {docstringPart} defined as {normalizedSignature} {context}
```

## 样例1：Rust函数

### 输入代码

```rust
/// Return `true` if ready, `false` if timed out.
pub fn await_ready_for_timeout(&self, timeout: Duration) -> bool {
    let mut is_ready = self.value.lock();
    if !*is_ready {
        !self.condvar.wait_for(&mut is_ready, timeout).timed_out()
    } else {
        true
    }
}
```

### AST解析信息

- **函数名**: `await_ready_for_timeout`
- **签名**: `fn await_ready_for_timeout(&self, timeout: Duration) -> bool`
- **文档字符串**: `Return true if ready, false if timed out`
- **上下文**: 模块 `common`, 文件 `is_ready.rs`, 结构体 `IsReady`

### 转换步骤

1. **命名规范化**:
   - `await_ready_for_timeout` → `await ready for timeout`
   - `IsReady` → `Is ready`

2. **文档字符串清洗**:
   - `Return true if ready, false if timed out`

3. **签名规范化**:
   - `fn await_ready_for_timeout(&self, timeout: Duration) -> bool`
   - → `fn await ready for timeout self timeout duration bool`

4. **上下文提取**:
   - `defined in struct Is ready module common file is_ready rs`

5. **文本组装**:
   ```
   Function Await ready for timeout that does Return true if ready false if timed out defined as fn await ready for timeout self timeout duration bool defined in struct Is ready module common file is_ready rs
   ```

### 输出结果

```
Function Await ready for timeout that does Return true if ready false if timed out defined as fn await ready for timeout self timeout duration bool defined in struct Is ready module common file is_ready rs
```

---

## 样例2：JavaScript函数

### 输入代码

```javascript
/**
 * Calculate the total price of all items in the cart
 * @param {Array} items - Array of cart items
 * @param {number} discount - Optional discount percentage (0-100)
 * @returns {number} Total price after applying discount
 */
function calculateTotalPrice(items, discount) {
    const subtotal = items.reduce((sum, item) => sum + item.price * item.quantity, 0);
    if (discount && discount > 0) {
        return subtotal * (1 - discount / 100);
    }
    return subtotal;
}
```

### AST解析信息

- **函数名**: `calculateTotalPrice`
- **签名**: `function calculateTotalPrice(items, discount)`
- **文档字符串**: `Calculate the total price of all items in the cart`
- **参数**: `items`, `discount`
- **返回类型**: number
- **上下文**: 文件 `cart.js`

### 转换步骤

1. **命名规范化**:
   - `calculateTotalPrice` → `calculate total price`

2. **文档字符串清洗**:
   - `Calculate the total price of all items in the cart`

3. **签名规范化**:
   - `function calculateTotalPrice(items, discount)`
   - → `function calculate total price items discount`

4. **上下文提取**:
   - `file cart js`

5. **文本组装**:
   ```
   Function Calculate total price that does Calculate the total price of all items in the cart defined as function calculate total price items discount file cart js
   ```

### 输出结果

```
Function Calculate total price that does Calculate the total price of all items in the cart defined as function calculate total price items discount file cart js
```

---

## 样例3：Python函数

### 输入代码

```python
def fetch_user_data(user_id, include_profile=False):
    """
    Fetch user data from the database.
    
    Args:
        user_id: The unique identifier of the user
        include_profile: Whether to include profile information
        
    Returns:
        Dictionary containing user data
    """
    user = db.query(User).filter(User.id == user_id).first()
    if not user:
        raise ValueError(f"User {user_id} not found")
    
    result = {
        'id': user.id,
        'name': user.name,
        'email': user.email
    }
    
    if include_profile:
        result['profile'] = user.profile
    
    return result
```

### AST解析信息

- **函数名**: `fetch_user_data`
- **签名**: `def fetch_user_data(user_id, include_profile=False)`
- **文档字符串**: `Fetch user data from the database`
- **参数**: `user_id`, `include_profile` (默认False)
- **返回类型**: dict
- **上下文**: 文件 `user_service.py`

### 转换步骤

1. **命名规范化**:
   - `fetch_user_data` → `fetch user data`

2. **文档字符串清洗**:
   - `Fetch user data from the database`

3. **签名规范化**:
   - `def fetch_user_data(user_id, include_profile=False)`
   - → `def fetch user data user id include profile false`

4. **上下文提取**:
   - `file user service`

5. **文本组装**:
   ```
   Function Fetch user data that does Fetch user data from the database defined as def fetch user data user id include profile false file user service
   ```

### 输出结果

```
Function Fetch user data that does Fetch user data from the database defined as def fetch user data user id include profile false file user service
```

---

## 样例4：Java方法

### 输入代码

```java
/**
 * Validates the user input and returns validation result
 * 
 * @param username the username to validate
 * @param password the password to validate
 * @return ValidationResult containing success status and error messages
 * @throws IllegalArgumentException if username or password is null
 */
public ValidationResult validateCredentials(String username, String password) {
    if (username == null || password == null) {
        throw new IllegalArgumentException("Username and password cannot be null");
    }
    
    if (username.length() < 3) {
        return ValidationResult.failure("Username must be at least 3 characters");
    }
    
    if (password.length() < 8) {
        return ValidationResult.failure("Password must be at least 8 characters");
    }
    
    return ValidationResult.success();
}
```

### AST解析信息

- **方法名**: `validateCredentials`
- **签名**: `public ValidationResult validateCredentials(String username, String password)`
- **文档字符串**: `Validates the user input and returns validation result`
- **参数**: `username` (String), `password` (String)
- **返回类型**: `ValidationResult`
- **上下文**: 类 `AuthService`, 文件 `AuthService.java`

### 转换步骤

1. **命名规范化**:
   - `validateCredentials` → `validate credentials`
   - `ValidationResult` → `validation result`
   - `AuthService` → `auth service`

2. **文档字符串清洗**:
   - `Validates the user input and returns validation result`

3. **签名规范化**:
   - `public ValidationResult validateCredentials(String username, String password)`
   - → `public validation result validate credentials string username string password`

4. **上下文提取**:
   - `of class auth service file auth service java`

5. **文本组装**:
   ```
   Function Validate credentials that does Validates the user input and returns validation result defined as public validation result validate credentials string username string password of class auth service file auth service java
   ```

### 输出结果

```
Function Validate credentials that does Validates the user input and returns validation result defined as public validation result validate credentials string username string password of class auth service file auth service java
```

---

## 样例5：C函数

### 输入代码

```c
/* Compute the greatest common divisor using Euclidean algorithm */
int gcd(int a, int b) {
    while (b != 0) {
        int temp = b;
        b = a % b;
        a = temp;
    }
    return a;
}
```

### AST解析信息

- **函数名**: `gcd`
- **签名**: `int gcd(int a, int b)`
- **文档字符串**: `Compute the greatest common divisor using Euclidean algorithm`
- **参数**: `a` (int), `b` (int)
- **返回类型**: `int`
- **上下文**: 文件 `math_utils.c`

### 转换步骤

1. **命名规范化**:
   - `gcd` → `gcd` (缩写保持原样)

2. **文档字符串清洗**:
   - `Compute the greatest common divisor using Euclidean algorithm`

3. **签名规范化**:
   - `int gcd(int a, int b)`
   - → `int gcd int a int b`

4. **上下文提取**:
   - `file math utils c`

5. **文本组装**:
   ```
   Function gcd that does Compute the greatest common divisor using Euclidean algorithm defined as int gcd int a int b file math utils
   ```

### 输出结果

```
Function gcd that does Compute the greatest common divisor using Euclidean algorithm defined as int gcd int a int b file math utils
```

---

## 转换要点总结

### 1. 命名规范化

| 原始命名 | 转换后 | 说明 |
|---------|--------|------|
| `await_ready_for_timeout` | `await ready for timeout` | 蛇形命名拆分 |
| `calculateTotalPrice` | `calculate total price` | 驼峰命名拆分 |
| `validateCredentials` | `validate credentials` | 驼峰命名拆分 |
| `gcd` | `gcd` | 缩写保持原样 |

### 2. 文档字符串处理

- 移除注释符号：`///`、`/**`、`*/`、`/*`
- 移除多余引号：`"`、`'`
- 保留核心描述文本

### 3. 签名规范化

- 移除语法符号：`()`、`->`、`,`、`:`、`[]`、`<>`
- 保留参数顺序和类型信息
- 默认值信息保留（如 `include_profile=False`）

### 4. 上下文信息

- 模块/包名
- 文件名
- 类/结构体名（如果是方法）
- 接收者信息（如Rust的`&self`）

### 5. 特殊情况处理

- **可选参数**：保留默认值信息
- **可变参数**：保留数组/列表类型
- **方法**：添加所属类信息
- **静态方法**：添加类信息