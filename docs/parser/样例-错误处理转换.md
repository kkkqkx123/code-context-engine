# 错误处理转换样例

## 概述

本文档展示如何将错误处理代码转换为自然语言表示。

## 转换模板

```
Error handling {description} with error type {errorType} {context}
```

## 样例1：try-catch 块

### 输入代码

```typescript
/**
 * Safely parse JSON with error handling
 */
function safeParseJSON(jsonString: string): any {
    try {
        return JSON.parse(jsonString);
    } catch (error) {
        console.error('Failed to parse JSON:', error);
        return null;
    }
}
```

### 转换结果

```
Error handling Safely parse JSON with error handling with error type JSON parse error
```

---

## 样例2：抛出异常

### 输入代码

```typescript
/**
 * Validate user input
 */
function validateUser(user: User): void {
    if (!user.email) {
        throw new Error('Email is required');
    }
    if (!user.name) {
        throw new Error('Name is required');
    }
}
```

### 转换结果

```
Error handling Validate user input with error type validation error
```

---

## 样例3：自定义错误类

### 输入代码

```typescript
/**
 * Custom validation error
 */
class ValidationError extends Error {
    constructor(message: string, public field: string) {
        super(message);
        this.name = 'ValidationError';
    }
}

/**
 * Validate user data
 */
function validateUserData(data: any): User {
    if (!data.email) {
        throw new ValidationError('Email is required', 'email');
    }
    return data;
}
```

### 转换结果

```
Error handling Custom validation error with error type validation error
Error handling Validate user data with error type validation error
```

---

## 样例4：Promise 错误处理

### 输入代码

```typescript
/**
 * Fetch data with error handling
 */
async function fetchData(url: string): Promise<Data> {
    try {
        const response = await fetch(url);
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return await response.json();
    } catch (error) {
        console.error('Fetch failed:', error);
        throw error;
    }
}
```

### 转换结果

```
Error handling Fetch data with error handling with error type network error
```

---

## 样例5：多错误类型处理

### 输入代码

```typescript
/**
 * Process file with multiple error types
 */
async function processFile(filePath: string): Promise<Result> {
    try {
        const content = await readFile(filePath);
        const data = JSON.parse(content);
        return processData(data);
    } catch (error) {
        if (error instanceof SyntaxError) {
            throw new Error('Invalid JSON format');
        } else if (error.code === 'ENOENT') {
            throw new Error('File not found');
        } else {
            throw new Error('Unknown error occurred');
        }
    }
}
```

### 转换结果

```
Error handling Process file with multiple error types with error type syntax error file not error unknown error
```

---

## 样例6：错误传播

### 输入代码

```typescript
/**
 * Service layer with error propagation
 */
class UserService {
    async getUser(id: string): Promise<User> {
        try {
            return await this.repository.findById(id);
        } catch (error) {
            throw new Error(`Failed to get user: ${error.message}`);
        }
    }
}
```

### 转换结果

```
Error handling Service layer with error propagation with error type repository error
```

---

## 样例7：错误恢复

### 输入代码

```typescript
/**
 * Retry operation with error recovery
 */
async function retryOperation<T>(
    operation: () => Promise<T>,
    maxRetries: number = 3
): Promise<T> {
    for (let i = 0; i < maxRetries; i++) {
        try {
            return await operation();
        } catch (error) {
            if (i === maxRetries - 1) {
                throw new Error(`Operation failed after ${maxRetries} retries`);
            }
            await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)));
        }
    }
    throw new Error('Max retries exceeded');
}
```

### 转换结果

```
Error handling Retry operation with error recovery with error type operation failed
```

---

## 样例8：错误日志记录

### 输入代码

```typescript
/**
 * Log errors with context
 */
function logError(error: Error, context: any): void {
    const errorInfo = {
        message: error.message,
        stack: error.stack,
        context: context,
        timestamp: new Date().toISOString()
    };
    console.error('Error occurred:', errorInfo);
    // Send to error tracking service
    errorTracker.track(errorInfo);
}
```

### 转换结果

```
Error handling Log errors with context with error type logging error
```

---

## 样例9：条件错误处理

### 输入代码

```typescript
/**
 * Validate and process with conditional errors
 */
function processRequest(request: Request): Response {
    if (!request.body) {
        return {
            status: 400,
            error: 'Request body is required'
        };
    }
    
    if (!request.body.email) {
        return {
            status: 400,
            error: 'Email is required'
        };
    }
    
    try {
        const result = processRequestData(request.body);
        return {
            status: 200,
            data: result
        };
    } catch (error) {
        return {
            status: 500,
            error: 'Internal server error'
        };
    }
}
```

### 转换结果

```
Error handling Validate and process with conditional errors with error type validation error processing error
```

---

## 样例10：异步错误处理链

### 输入代码

```typescript
/**
 * Chain operations with error handling
 */
async function processChain(data: Data): Promise<Result> {
    try {
        const validated = await validateData(data);
        const transformed = await transformData(validated);
        const saved = await saveData(transformed);
        return saved;
    } catch (error) {
        if (error instanceof ValidationError) {
            throw new Error(`Validation failed: ${error.message}`);
        } else if (error instanceof TransformError) {
            throw new Error(`Transform failed: ${error.message}`);
        } else if (error instanceof SaveError) {
            throw new Error(`Save failed: ${error.message}`);
        } else {
            throw new Error('Unknown error in processing chain');
        }
    }
}
```

### 转换结果

```
Error handling Chain operations with error handling with error type validation error transform error save error unknown error
```

---

## 样例11：资源清理错误处理

### 输入代码

```typescript
/**
 * Process file with resource cleanup
 */
async function processFileWithCleanup(filePath: string): Promise<void> {
    let fileHandle: FileHandle | null = null;
    try {
        fileHandle = await open(filePath, 'r');
        const content = await fileHandle.readFile();
        await processContent(content);
    } catch (error) {
        console.error('File processing failed:', error);
        throw error;
    } finally {
        if (fileHandle) {
            await fileHandle.close();
        }
    }
}
```

### 转换结果

```
Error handling Process file with resource cleanup with error type file processing error
```

---

## 样例12：错误聚合

### 输入代码

```typescript
/**
 * Validate multiple fields and aggregate errors
 */
function validateMultiple(data: any): ValidationResult {
    const errors: string[] = [];
    
    if (!data.email) {
        errors.push('Email is required');
    }
    
    if (!data.name) {
        errors.push('Name is required');
    }
    
    if (data.age && data.age < 18) {
        errors.push('Age must be at least 18');
    }
    
    if (errors.length > 0) {
        return {
            valid: false,
            errors: errors
        };
    }
    
    return {
        valid: true,
        data: data
    };
}
```

### 转换结果

```
Error handling Validate multiple fields and aggregate errors with error type validation errors
```

---

## 转换要点

1. **错误类型识别**：识别错误处理的类型（try-catch、throw、自定义错误）
2. **错误描述**：描述错误处理的目的和逻辑
3. **错误分类**：区分不同类型的错误（验证错误、网络错误、文件错误等）
4. **恢复策略**：描述错误恢复或重试机制
5. **资源清理**：标注 finally 块中的资源清理逻辑

## 处理策略

- **简单错误处理**：描述基本的 try-catch 逻辑
- **自定义错误**：标注自定义错误类
- **错误传播**：描述错误如何向上传播
- **错误恢复**：描述重试和恢复机制
- **错误聚合**：描述多个错误的收集和处理
- **资源清理**：描述资源释放逻辑